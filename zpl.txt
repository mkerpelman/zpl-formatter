<% isconsol = (jobBatch.toObject().jobs[0].type? true : false) %><%= (isconsol?'^XA':'') %>^AA,48,26^NO^FO19,244^FD<%- 'Order Type'%><% this_job = (isconsol ? _.filter(jobBatch.toObject().jobs, function(j) { return j.data.isLastChunk; })[0] : jobBatch.toObject().jobs[0]); parent_job= (isconsol?_.filter(jobBatch.toObject().jobs, function(j) { return j.type=='consolidation'; })[0]:jobBatch.toObject().jobs[0]); %>^FS^AA,48,26^NO^FO676,724^FD<%- (_.sum(_.map(parent_job.lines, 'quantity'))) %>^FS^AA,56,19^NO^FO19,330^FDOrder:^FS^AA,48,20^NO^FO180,330^FD<%- this_job.externalId.slice(0, -2) %>^FS^AA,48,26^NO^FO680,629^FD<%- parent_job.lines.length %>^FS^AA,48,26^NO^FO19,432^FDConsolidation ID:^FS^AA,48,26^NO^FO23,529^FDCarton Number:^FS^AA,78,22^NO^FO29,71^FDLAST CONTAINER NOTIFICATION^FS^AA,48,26^NO^FO735,527^FD<%- this_job.data.number %>^FS^AA,70,37^NO^FO33,995^FDExceptions:^FS^AA,70,37^NO^FO651,997^FD<%- %><% exceptions = []; _.forEach(jobBatch.toObject().jobs, function(j){ console.log(j.lines.length); _.forEach(j.lines, function(l){l.externalToteId=j.externalToteId; if(l.quantity > l.doneQuantity){exceptions.push(l)} }) }); %><%- exceptions.length %>^FS^AA,48,26^NO^FO553,242^FD<%- %><% waveTypes={'6RS-CART PICK+REPLEN': 'WEB','6RS-CPF+REPL+PICK': 'PF','6RS-REPLENISH+PICKING': 'DEALER' }; this_job = this_job;%><%- waveTypes[this_job.data.waveType] %>^FS^AA,48,26^NO^FO682,428^FD<%- this_job.batchDisplayId %>^FS^AA,48,17^NO^FO23,826^FD<%- 'ShipDate: '+Date(this_job.expectedShipDate).toString() %>^FS^AA,54,30^NO^FO31,637^FDOrder Lines:^FS^AA,58,31^NO^FO27,730^FDOrder Units:^FS^XZ<% _.forEach(exceptions, function(exception) {%>^XA^AA,48,26^NO^FO15,444^FDOrder Type:^FS^AA,48,26^NO^FO391,448^FD<%- waveTypes[this_job.data.waveType] %>^FS^AA,48,26^NO^FO8,157^FDOrder: ^FS^AA,48,26^NO^FO190,153^FD<%- this_job.externalId.slice(0, -2) %>^FS^AA,48,26^NO^FO19,244^FDConsolidation ID:^FS^AA,48,26^NO^FO674,250^FD<%- this_job.batchDisplayId %>^FS^AA,58,31^NO^FO89,59^FDEXCEPTION TICKET^FS^AA,48,26^NO^FO458,732^FD<%- exception.sourceLoc.address %>^FS^AA,48,26^NO^FO19,728^FDSKU Location:^FS^AA,48,26^NO^FO33,832^FDUnit Count Expected:^FS^AA,48,26^NO^FO670,836^FD<%- exception.quantity %>^FS^AA,48,26^NO^FO25,924^FDUnit Count Picked: ^FS^AA,48,26^NO^FO666,922^FD<%- exception.doneQuantity %>^FS^AA,48,26^NO^FO312,543^FD<%- exception.status %>^FS^AA,48,26^NO^FO19,543^FDReason:^FS^AA,54,29^NO^FO19,631^FDUPC Number^FS^AA,54,20^NO^FO17,344^FD<%- 'Container ID: ' + exception.externalToteId %>^FS^AA,52,25^NO^FO413,635^FD<%- exception.productType.externalId.slice(0, -2) %>^FS^AA,52,27^NO^FO27,1009^FDPrintDate:^FS^AA,50,18^NO^FO20,1105^FD<%- new Date().toString('en-us', {'timeZone': 'America/New_York'}) %>^FS^XZ<% }); %>